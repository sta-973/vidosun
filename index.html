<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vidosun - Downloader Sosial Media</title>
<style>
body {
    background: #111; 
    color: #eee;
    font-family: 'Poppins', sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 30px;
    text-align: center;
}
.container {
    background: #222;
    padding: 25px;
    border-radius: 12px;
    max-width: 500px;
    width: 100%;
}
input[type="text"] {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: none;
    margin-bottom: 12px;
}
button {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background: #ffce00;
    font-weight: bold;
}
#downloadLink {
    display: block;
    margin-top: 15px;
    color: #0af;
}
#resetBtn {
    margin-top: 10px;
    background: #f33;
    color: #fff;
}
</style>
</head>
<body>

<div class="container">
<h2>Unduh Video dari Sosial Media</h2>
<input type="text" id="urlInput" placeholder="Tempel link video di sini..." required>
<button id="downloadBtn">Download</button>
<a id="downloadLink" href="#" target="_blank"></a>
<button id="resetBtn">Reset Download</button>
</div>

<script>
const urlInput = document.getElementById("urlInput");
const downloadBtn = document.getElementById("downloadBtn");
const downloadLink = document.getElementById("downloadLink");
const resetBtn = document.getElementById("resetBtn");

downloadBtn.addEventListener("click", async () => {
    const url = urlInput.value.trim();
    if (!url) return alert("Masukkan URL video terlebih dahulu!");
    downloadBtn.disabled = true;
    downloadBtn.textContent = "Proses download...";

    await fetch("/download", {
        method: "POST",
        headers: {"Content-Type":"application/x-www-form-urlencoded"},
        body: new URLSearchParams({url: url, format: "best"})
    });

    const interval = setInterval(async () => {
        let res = await fetch(`/progress?url=${encodeURIComponent(url)}`);
        let data = await res.json();

        if(data.status === "done") {
            clearInterval(interval);
            downloadBtn.disabled = false;
            downloadBtn.textContent = "Download";
            downloadLink.href = `/getfile?url=${encodeURIComponent(url)}`;
            downloadLink.textContent = "Klik di sini untuk mengunduh video";
        } else if(data.status === "error") {
            clearInterval(interval);
            alert("Gagal download");
            downloadBtn.disabled = false;
            downloadBtn.textContent = "Download";
        } else {
            downloadBtn.textContent = `Download... ${data.progress}% (${data.eta}s tersisa)`;
        }
    }, 2000);
});

// Reset download
resetBtn.addEventListener("click", async () => {
    const url = urlInput.value.trim();
    if(!url) return;
    await fetch("/reset", {
        method: "POST",
        headers: {"Content-Type":"application/x-www-form-urlencoded"},
        body: new URLSearchParams({url:url})
    });
    downloadLink.href = "#";
    downloadLink.textContent = "";
    downloadBtn.disabled = false;
    downloadBtn.textContent = "Download";
});
</script>

</body>
</html>
