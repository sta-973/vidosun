<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="google-site-verification" content="RvYdoR8BfUECZAC7WYGXNk2NCxVuAF2ZrPS4zWlxrDk" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Downloader Sosial Media - Advanced</title>
<link rel="icon" href="https://cdn-icons-png.flaticon.com/512/724/724933.png">
<meta name="description" content="Unduh video dan audio dari YouTube, TikTok, dan sosial media lainnya dengan cepat dan aman.">
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; background: #f8f9fa; color: #333; }
  input, select { padding: 8px; width: 300px; margin: 5px; border: 1px solid #ccc; border-radius: 5px; }
  button { padding: 8px 15px; margin-top: 5px; border: none; border-radius: 5px; background: #007bff; color: #fff; cursor: pointer; }
  button:hover { background: #0056b3; }
  #bar-container { width: 300px; height: 20px; background: #ddd; margin: 15px auto; border-radius: 10px; overflow: hidden; display: none; }
  #bar { width: 0%; height: 100%; background: #007bff; transition: width 0.3s; }
  #message { margin-top: 10px; font-size: 14px; }
</style>
</head>
<body>
<h1>📥 YouTube & Sosial Media Downloader</h1>

<input type="text" id="url" placeholder="Tempel URL di sini..."><br>
<select id="format">
  <option value="best">Video & Audio (terbaik)</option>
  <option value="bestaudio">Audio Saja</option>
  <option value="bestvideo">Video Saja</option>
</select><br>
<button id="btnDownload">Mulai Download</button>

<div id="bar-container"><div id="bar"></div></div>
<div id="message"></div>

<script>
const btn = document.getElementById('btnDownload');
const urlInput = document.getElementById('url');
const formatSelect = document.getElementById('format');
const bar = document.getElementById('bar');
const barContainer = document.getElementById('bar-container');
const msg = document.getElementById('message');

btn.addEventListener('click', async () => {
  const url = urlInput.value.trim();
  const fmt = formatSelect.value;
  if (!url) return alert('Masukkan URL dulu!');

  bar.style.width = '0%';
  barContainer.style.display = 'block';
  msg.textContent = '🔄 Memulai download...';

  try {
    const res = await fetch('/download', {
      method: 'POST',
      body: new URLSearchParams({ url, format: fmt })
    });
    const data = await res.json();
    if (data.status !== 'started') throw new Error('Gagal memulai download');
  } catch (e) {
    msg.textContent = '❌ Tidak bisa menghubungi server.';
    barContainer.style.display = 'none';
    return;
  }

  const interval = setInterval(async () => {
    try {
      const res = await fetch('/progress?url=' + encodeURIComponent(url));
      const data = await res.json();

      if (data.status === 'downloading') {
        bar.style.width = data.progress + '%';
        msg.textContent = `Mengunduh... ${data.progress}%`;
      } else if (data.status === 'done') {
        bar.style.width = '100%';
        msg.innerHTML = `✅ Selesai! <a href="/getfile">Klik di sini untuk unduh</a>`;
        clearInterval(interval);
        setTimeout(() => barContainer.style.display = 'none', 4000);
      } else if (data.status.startsWith('error')) {
        msg.textContent = '❌ ' + data.status;
        clearInterval(interval);
        setTimeout(() => barContainer.style.display = 'none', 4000);
      }
    } catch {
      msg.textContent = '⚠️ Gagal membaca progres.';
      clearInterval(interval);
      setTimeout(() => barContainer.style.display = 'none', 4000);
    }
  }, 1000);
});
</script>
</body>
</html>

